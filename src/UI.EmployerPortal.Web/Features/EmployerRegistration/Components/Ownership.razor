@rendermode InteractiveServer
@using UI.EmployerPortal.Web.Features.EmployerRegistration.Models
@using UI.EmployerPortal.Web.Features.EmployerRegistration.Components.OwnershipForms
@using UI.EmployerPortal.Web.Features.EmployerRegistration.Components.Shared

<div class="ownership-container">
    <h1 class="ownership-title">Ownership</h1>

    @if (!_isSessionLoaded)
    {
        <p>Loading...</p>
    }
    else
    {
        <!-- Validation Error Summary -->
        @if (_showValidationSummary && ValidationErrors.Any())
        {
            <div class="validation-summary">
                <ul>
                    @foreach (var error in ValidationErrors)
                    {
                        <li>@error</li>
                    }
                </ul>
            </div>
        }

        <form>
            <div class="form-section">
                <!-- Ownership Type -->                
                <OwnershipTypeSelect Id="ownership-type"
                                     Label="Ownership Type"
                                     @bind-Value="SelectedOwnershipType"
                                     @bind-Value:after="OnOwnershipTypeChanged"
                                     IsRequired="true" />

                <!-- Headquartered Outside USA Checkbox -->
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" @bind="IsOutsideUSA" />
                        <span>The business is headquartered outside of the United States</span>
                    </label>
                </div>

                @* Render dynamic component based on ownership type *@
                @if (SelectedOwnershipType != OwnershipType.None && _ownershipComponentMap.ContainsKey(SelectedOwnershipType))
                {
                    <DynamicComponent Type="@_ownershipComponentMap[SelectedOwnershipType]"
                                      Parameters="@GetComponentParameters()" />
                }
            </div>

            <!-- Navigation Buttons -->
            <div class="form-actions">
                <button type="button" class="btn btn-back" @onclick="GoBack">
                    <span class="btn-icon">‹</span> BACK
                </button>
                <div class="form-actions-right">
                    <button type="button" class="btn btn-save" @onclick="OnSaveAndQuit">
                        SAVE & QUIT
                    </button>
                    <button type="button"
                            class="btn btn-continue"
                            @onclick="GoNext">
                        CONTINUE <span class="btn-icon">›</span>
                    </button>
                </div>
            </div>
        </form>
    }
</div>
